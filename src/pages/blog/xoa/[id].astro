---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Header from '../../../components/Header.astro';
import Footer from '../../../components/Footer.astro';
import { getPostById } from '../../../lib/blog';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
	const blogEntries = await getCollection('blog');
	return blogEntries.map((entry) => ({
		params: { id: entry.id },
	}));
}

const { id } = Astro.params;
const post = id ? await getPostById(id) : null;

if (!post) {
	return Astro.redirect('/blog');
}
---

<BaseLayout 
	title={`Xóa bài viết: ${post.title} - Blog Yến Sào Premium`}
	description="Xóa bài viết"
>
	<Header />
	<main class="min-h-screen py-8">
		<div class="container mx-auto px-4 max-w-4xl">
			<div class="bg-white rounded-lg shadow-md p-8">
				<h1 class="text-4xl font-bold mb-6 text-gray-800">Xóa bài viết</h1>
				
				<div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-6">
					<h2 class="text-xl font-semibold text-red-800 mb-2">Bạn có chắc chắn muốn xóa bài viết này?</h2>
					<p class="text-red-700 mb-4"><strong>{post.title}</strong></p>
					<p class="text-red-600 text-sm">
						Để xóa bài viết, bạn cần xóa file <code class="bg-red-100 px-2 py-1 rounded">{post.slug}.md</code> 
						trong thư mục <code class="bg-red-100 px-2 py-1 rounded">src/content/blog/</code> và chạy lại build.
					</p>
				</div>

				<div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
					<h3 class="font-semibold text-blue-800 mb-2">Hướng dẫn xóa:</h3>
					<ol class="list-decimal list-inside text-blue-700 space-y-2 text-sm">
						<li>Mở thư mục <code class="bg-blue-100 px-1 rounded">src/content/blog/</code></li>
						<li>Tìm và xóa file <code class="bg-blue-100 px-1 rounded">{post.slug}.md</code></li>
						<li>Chạy <code class="bg-blue-100 px-1 rounded">npm run build</code> để rebuild website</li>
						<li>Bài viết sẽ không còn xuất hiện trên website</li>
					</ol>
				</div>

				<div class="flex gap-4">
					<a 
						href={`/blog/${post.slug}`}
						class="bg-gray-300 text-gray-700 px-6 py-3 rounded-lg font-semibold hover:bg-gray-400 transition"
					>
						Quay lại
					</a>
					<a 
						href="/blog"
						class="bg-amber-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-amber-700 transition"
					>
						Về danh sách blog
					</a>
				</div>
			</div>
		</div>
	</main>
	<Footer />
	<script>
		import { isAuthenticated } from '../../../lib/auth';
		
		// Check authentication
		if (!isAuthenticated()) {
			window.location.href = `/login?return=${encodeURIComponent(window.location.pathname)}`;
		}
	</script>
</BaseLayout>

