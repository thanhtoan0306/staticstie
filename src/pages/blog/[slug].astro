---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

export function getStaticPaths() {
	// Return empty array since posts are loaded client-side from localStorage
	return [];
}
---

<BaseLayout 
	title="Blog - Yến Sào Premium"
	description="Đọc bài viết về yến sào"
>
	<Header />
	<main class="min-h-screen py-8">
		<div class="container mx-auto px-4 max-w-4xl">
			<div id="post-container">
				<div class="text-center py-12">
					<p class="text-gray-600">Đang tải...</p>
				</div>
			</div>
		</div>
	</main>
	<Footer />
	<script>
		import { getPostBySlug, deletePost } from '../../lib/blog-client';
		
		const slug = window.location.pathname.split('/').pop();
		const post = slug ? getPostBySlug(slug) : null;
		
		const container = document.getElementById('post-container');
		
		if (!post || !container) {
			container.innerHTML = `
				<div class="text-center py-12">
					<p class="text-gray-600 text-lg mb-4">Không tìm thấy bài viết</p>
					<a href="/blog" class="text-amber-600 hover:underline">Quay lại danh sách</a>
				</div>
			`;
		} else {
			container.innerHTML = `
				<article class="bg-white rounded-lg shadow-md p-8">
					<div class="mb-6">
						<a href="/blog" class="text-amber-600 hover:underline mb-4 inline-block">
							← Quay lại danh sách
						</a>
						<h1 class="text-4xl font-bold text-gray-800 mb-4">${post.title}</h1>
						<div class="flex items-center gap-4 text-gray-600 text-sm mb-6">
							<span>Tác giả: ${post.author}</span>
							<span>•</span>
							<span>${new Date(post.publishedAt).toLocaleDateString('vi-VN')}</span>
							${post.updatedAt ? `<span>•</span><span>Cập nhật: ${new Date(post.updatedAt).toLocaleDateString('vi-VN')}</span>` : ''}
						</div>
						<div class="flex gap-2 mb-6">
							<a href="/blog/sua/${post.id}" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
								Sửa bài viết
							</a>
							<button 
								id="delete-btn"
								data-id="${post.id}"
								class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition"
							>
								Xóa bài viết
							</button>
						</div>
					</div>
					<div class="h-64 bg-amber-100 rounded-lg mb-6"></div>
					<div class="prose prose-lg max-w-none">
						<div class="whitespace-pre-wrap text-gray-700">${post.content}</div>
					</div>
					${post.tags && post.tags.length > 0 ? `
						<div class="mt-8 pt-6 border-t border-gray-200">
							<div class="flex flex-wrap gap-2">
								${post.tags.map(tag => `<span class="bg-amber-100 text-amber-800 px-3 py-1 rounded-full text-sm">${tag}</span>`).join('')}
							</div>
						</div>
					` : ''}
				</article>
			`;
			
			// Update page title
			document.title = `${post.title} - Blog Yến Sào Premium`;
			
			// Delete button handler
			const deleteBtn = document.getElementById('delete-btn');
			if (deleteBtn) {
				deleteBtn.addEventListener('click', () => {
					if (!confirm('Bạn có chắc chắn muốn xóa bài viết này?')) {
						return;
					}
					const id = deleteBtn.getAttribute('data-id');
					if (id && deletePost(id)) {
						window.location.href = '/blog';
					} else {
						alert('Có lỗi xảy ra khi xóa bài viết');
					}
				});
			}
		}
	</script>
</BaseLayout>
