---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
---

<BaseLayout 
	title="Đăng nhập Admin - Yến Sào Premium"
	description="Trang đăng nhập quản trị viên"
>
	<Header />
	<main class="min-h-screen py-16 flex items-center justify-center">
		<div class="container mx-auto px-4 max-w-md">
			<div class="bg-white rounded-lg shadow-md p-8">
				<h1 class="text-3xl font-bold text-center mb-8 text-gray-800">Đăng nhập Admin</h1>
				<form id="login-form" class="space-y-6">
					<div>
						<label class="block text-gray-700 font-semibold mb-2">Tên đăng nhập</label>
						<input 
							type="text" 
							id="username"
							name="username"
							required
							autocomplete="username"
							class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-600"
							placeholder="Nhập tên đăng nhập"
						/>
					</div>
					<div>
						<label class="block text-gray-700 font-semibold mb-2">Mật khẩu</label>
						<input 
							type="password" 
							id="password"
							name="password"
							required
							autocomplete="current-password"
							class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-600"
							placeholder="Nhập mật khẩu"
						/>
					</div>
					<div id="error-message" class="hidden text-red-600 text-sm"></div>
					<button 
						type="submit"
						class="w-full bg-amber-600 text-white py-3 rounded-lg font-semibold hover:bg-amber-700 transition"
					>
						Đăng nhập
					</button>
				</form>
				<div class="mt-6 text-center text-sm text-gray-500">
					<p>Thông tin đăng nhập mặc định:</p>
					<p class="mt-2 font-mono bg-gray-100 px-3 py-2 rounded">
						Username: <strong>admin</strong><br/>
						Password: <strong>1</strong>
					</p>
				</div>
			</div>
		</div>
	</main>
	<Footer />
	<script>
		import { login, isAuthenticated } from '../lib/auth';
		
		const form = document.getElementById('login-form');
		const errorMessage = document.getElementById('error-message');
		
		// Check if already logged in
		if (isAuthenticated()) {
			const returnUrl = new URLSearchParams(window.location.search).get('return') || '/blog';
			window.location.href = returnUrl;
		}
		
		form?.addEventListener('submit', (e) => {
			e.preventDefault();
			const formData = new FormData(form);
			const username = formData.get('username')?.toString() || '';
			const password = formData.get('password')?.toString() || '';
			
			if (login(username, password)) {
				// Redirect to blog page
				const returnUrl = new URLSearchParams(window.location.search).get('return') || '/blog';
				window.location.href = returnUrl;
			} else {
				errorMessage?.classList.remove('hidden');
				errorMessage!.textContent = 'Tên đăng nhập hoặc mật khẩu không đúng!';
			}
		});
	</script>
</BaseLayout>

